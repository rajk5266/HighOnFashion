---
import Layout from "../../layouts/Layout.astro";
import ProductsGrid from "../../components/ProductsGrid.astro";
import FiltersBar from "../../components/FiltersBar.astro";
import { collections } from "../../data/collections";
import { products } from "../../data/products";

export async function getStaticPaths() {
  return collections.map((collection) => ({
    params: { id: collection.id }
  }));
}

const { id } = Astro.params;

const collection = collections.find(c => c.id === id);
if (!collection) throw new Error(`Collection not found: ${id}`);

const collectionProducts = products.filter(
  product => product.collectionId === id
);
---

<Layout title={collection.name} description={collection.description}>

  <!-- HERO -->
  <section class="relative h-[60vh] w-full overflow-hidden">
    <img
      src={collection.image}
      alt={collection.alt || collection.name}
      class="absolute inset-0 w-full h-full object-cover"
    />
    <div class="absolute inset-0 bg-black/40"></div>

    <div class="relative z-10 max-w-7xl mx-auto h-full flex flex-col justify-end px-6 pb-16 text-white">
      <p class="uppercase tracking-widest text-sm mb-2">
        {collection.season}
      </p>
      <h1 class="text-4xl md:text-5xl font-serif mb-4">
        {collection.name}
      </h1>
      <p class="max-w-xl text-white/90">
        {collection.description}
      </p>
    </div>
  </section>

  <!-- TABS -->
  <section class="max-w-7xl mx-auto px-6 pt-12">
    <div class="flex gap-6 border-b">
      <a
        href="/collections"
        class="pb-3 text-neutral-400 hover:text-black"
      >
        Collections
      </a>

      <span
        class="pb-3 border-b-2 border-black font-medium"
      >
        Products
      </span>
    </div>
  </section>

  <!-- FILTER + PRODUCTS -->
  <section class="max-w-7xl mx-auto px-6 py-16">
    <FiltersBar />
    <ProductsGrid products={collectionProducts} />
  </section>

</Layout>
